from Crypto.Cipher import AES
from project import cbc_flip_fix
from project import cbc_custom_decrypt

key = b'1122334455667788'
iv = b'8877665544332211'
message = b'1' * 16 + b'a' * 16 + b'2' * 16 + b'b' * 16 + b'3' * 16 + b'c' * 16
aes = AES.new(key, AES.MODE_CBC, iv)
cipher = aes.encrypt(message)
print(f'\033[92m[ORIGINAL MESSAGE]: {message}\n[KEY]: {key}\n[IV]: {iv}\n[ORIGINAL CIPHER]: {cipher}\033[0m')
list_of_flip_indexes = [1, 12, 157, 223, 334, 315, 458, 511, 550]
corrupted_ciphers = [
    b"\xef\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xc5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlF\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\x08@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9a\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\xb7\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>y\x10\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa1\xa9\xa9Y\xa0\xb5N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b",
    b"o\xd5&O9\xc3{`\xde<\xae'$?\xd2\xcf;\xadlN\x8a^-\x1e\xb4J\x96\n@\x0c>\xc0i\x15&\xe6r\xd1\x06\x97\xfe\x9e\x89\xb7$\xe3Z@Y\x1a\xf2\x109\xb4\xee>yP\x9e\x87\xed\x94Y\xa3\xa9\xa9Y\xa0\xb1N\xd3\x05\xe8:\xa5\x08jeFK\x11zB\x92r\x0bvC\x117\xcb\x02\xf4\xcd\x06b"]
try:
    for i, corrupted_cipher in enumerate(corrupted_ciphers):
        print(f"\033[1m\033[4mFor flipped bit {list_of_flip_indexes[i]}:\033[0m")
        print(f"\033[91m[CORRUPTED CIPHER] {corrupted_cipher}\033[0m")
        print(f"\033[93m[CORRUPTED MESSAGE] For flipped bit in index {list_of_flip_indexes[i]}: {cbc_custom_decrypt(key, 6, iv + corrupted_cipher)}\033[0m")
        print(f"\033[94m[FIXED] For flipped bit in index {list_of_flip_indexes[i]}: {cbc_flip_fix(key, 6, iv + corrupted_cipher)}\033[0m")
except Exception as err:
    print(f"ERROR: {err}")
    pass